<!--DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Portal</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }

        h1 {
            color: #333;
        }

        input, button {
            padding: 10px;
            margin: 5px 0;
            font-size: 16px;
        }

        button {
            cursor: pointer;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #0056b3;
        }

        #apiResponse {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #f9f9f9;
        }

        #apiResponse.error {
            border-color: #dc3545;
            background-color: #f8d7da;
        }

        #apiResponse.success {
            border-color: #28a745;
            background-color: #d4edda;
        }
    </style>
</head>

<body>
    <h1>API Interaction Portal</h1>
    <p>Enter some text below and click "Call API" to interact with the server.</p>

    <label for="inputText">Your Input:</label>
    <input type="text" id="inputText" placeholder="Enter some text" aria-label="Text input for API" />

    <button id="apiButton">Call API</button>

    <div id="apiResponse" aria-live="polite"></div>

    <script>
        document.getElementById('apiButton').addEventListener('click', async () => {
            const userInput = document.getElementById('inputText').value;

            if (!userInput.trim()) {
                document.getElementById('apiResponse').className = 'error';
                document.getElementById('apiResponse').innerHTML = '<strong>Error:</strong> Input cannot be empty.';
                return;
            }

            const apiUrl = '/getHelloWorld';

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name: userInput })
                });

                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('apiResponse').className = 'success';
                    document.getElementById('apiResponse').innerHTML = `<strong>Response:</strong> ${data.message}`;
                } else {
                    const errorData = await response.json();
                    document.getElementById('apiResponse').className = 'error';
                    document.getElementById('apiResponse').innerHTML = `<strong>Error:</strong> ${errorData.error} (${response.status} - ${response.statusText})`;
                }
            } catch (error) {
                document.getElementById('apiResponse').className = 'error';
                document.getElementById('apiResponse').innerHTML = `<strong>Error:</strong> ${error.message}`;
            }
        });
    </script>
</body>

</html-->


<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insulin Predictor</title>
    <!-- Import a chart library (Chart.js) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* General Page Styling */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }

        /* Header Styling */
        header {
            background-color: #000;
            color: #fff;
            text-align: center;
            padding: 1rem;
            font-size: 1.5rem;
            font-weight: bold;
        }

        /* Main Container */
        .container {
            display: flex;
            gap: 1rem;
            margin: 1rem;
        }

        /* Left Section: Recipes */
        .recipes {
            flex: 1;
            background-color: #fff;
            border-radius: 5px;
            padding: 1rem;
            box-shadow: 0 0 5px #aaa;
            max-width: 25%;
        }

        .recipes input {
            width: 100%;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .recipes button {
            width: 100%;
            background-color: #d3d3d3;
            border: none;
            padding: 0.5rem;
            cursor: pointer;
        }

        .recipe-list {
            margin-top: 1rem;
            max-height: 400px;
            overflow-y: auto;
        }

        .recipe-item {
            border: 1px solid #e0e0e0;
            border-radius: 3px;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
        }

        .recipe-item.selected {
            background-color: #e8f9e8;
            border: 1px solid #7cd67c;
        }

        /* Right Section: Graph & Details */
        .details {
            flex: 3;
            background-color: #fff;
            border-radius: 5px;
            padding: 1rem;
            box-shadow: 0 0 5px #aaa;
        }

        #glucoseChart {
            height: 300px;
            margin-bottom: 1rem;
        }

        .insulin-input {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        select, input {
            padding: 0.5rem;
        }

        .recipe-details {
            font-size: 1rem;
        }

    </style>
</head>

<body>
    <!-- Header -->
    <header>Insulin Predictor</header>

    <!-- Main Container -->
    <div class="container">
        <!-- Left Section: Recipe Input and List -->
        <div class="recipes">
            <input type="text" id="ingredientsInput" placeholder="Ingredient_1, ingredient2 ..." />
            <button id="generateRecipesBtn">GENERATE RECIPES</button>

            <!-- Recipe List -->
            <div class="recipe-list" id="recipeList">
                <!-- Recipes will be dynamically inserted here -->
            </div>
        </div>

        <!-- Right Section: Details and Chart -->
        <div class="details">
            <!-- Chart Section -->
            <canvas id="glucoseChart"></canvas>

            <!-- Insulin Input -->
            <div class="insulin-input">
                <label for="insulinDoses">Insulin Doses:</label>
                <select id="insulinDoses">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                </select>
            </div>

            <!-- Recipe Details -->
            <div id="recipeDetails" class="recipe-details">
                <strong>RECIPE 1</strong>
                <p>Ingredients: ???</p>
                <p>Glycemic Index: 180</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // API Key should be handled securely (not directly in client-side code)
    
    /* import dotenv from 'dotenv';
    dotenv.config();

    const SPOONACULAR_API_KEY = process.env.SPOONACULAR_API_KEY;

    if (!SPOONACULAR_API_KEY) {
        console.error('Spoonacular API Key is not defined');
        alert('API configuration error');
    } */

    // Recipe and Chart Handling
    const generateRecipesBtn = document.getElementById("generateRecipesBtn");
    const recipeList = document.getElementById("recipeList");
    const glucoseChartCanvas = document.getElementById("glucoseChart");
    const recipeDetails = document.getElementById("recipeDetails");
    const insulinDosesSelect = document.getElementById("insulinDoses");

    let glucoseChart; // Chart instance
    let recipes = []; // Store API response recipes

    // Function to fetch recipes based on ingredients
    async function fetchRecipes(ingredients) {
        const url = `https://api.spoonacular.com/recipes/findByIngredients?ingredients=${ingredients.join(',')}&apiKey=${SPOONACULAR_API_KEY}`;
        
        try {
            console.log('Fetching recipes from URL:', url);
    
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
    
            const data = await response.json();
            console.log('Received data:', data);
    
            // Map the received data to the desired format
            const recipes = await Promise.all(data.map(async (recipe) => {
                // Fetch detailed recipe information, including ingredients and glycemic load
                const recipeDetailsUrl = `https://api.spoonacular.com/recipes/${recipe.id}/information?includeNutrition=true&apiKey=${SPOONACULAR_API_KEY}`;
                const recipeResponse = await fetch(recipeDetailsUrl);
                const recipeDetails = await recipeResponse.json();
    
                // Extract relevant data
                return {
                    id: recipe.id,
                    title: recipe.title,
                    image: recipe.image,
                    glycemicLoad: recipeDetails.glycemicLoad || 'N/A', // Example placeholder
                    ingredients: recipeDetails.extendedIngredients
                        ? recipeDetails.extendedIngredients.map(ing => ing.name).join(', ')
                        : 'N/A'
                };
            }));
    
            return recipes;
        } catch (error) {
            console.error('Error fetching recipes:', error);
            return [];
        }
    }
    

    /* async function fetchRecipes() {
        return [
        { id: 1, ingredients: "Carrots, Rice", glycemicIndex: 180 },
        { id: 2, ingredients: "Bread, Eggs", glycemicIndex: 160 },
        { id: 3, ingredients: "Pasta, Cheese", glycemicIndex: 200 }
        ];
    } */
    
    // Mock function to calculate glycemic index
    function calculateGlycemicIndex() {
        return Math.floor(Math.random() * 100) + 100;
    }
    
    // Event Listener: Generate Recipes
    generateRecipesBtn.addEventListener("click", async () => {
        const input = document.getElementById("ingredientsInput").value;
        const ingredients = input.split(',').map(ing => ing.trim());

        if (ingredients.length === 0 || input.trim() === '') {
            alert("Please enter ingredients!");
            return;
        }

        // Fetch recipes
        recipes = await fetchRecipes(ingredients);

        // Populate recipe list
        recipeList.innerHTML = "";
        recipes.forEach((recipe, index) => {
            const recipeItem = document.createElement("div");
            recipeItem.className = "recipe-item";
            recipeItem.innerHTML = `
                <strong>RECIPE ${index + 1}</strong><br>
                Ingredients: ${recipe.ingredients}<br>
                Glycemic Index: ${recipe.glycemicIndex}
            `;
            recipeItem.onclick = () => displayRecipeDetails(recipe, index, recipeItem);
            recipeList.appendChild(recipeItem);
        });
    });

    // Display Recipe Details and Update Chart
    function displayRecipeDetails(recipe, index, selectedItem) {
        // Highlight selected recipe
        document.querySelectorAll(".recipe-item").forEach(item => item.classList.remove("selected"));
        selectedItem.classList.add("selected");

        // Update recipe details
        recipeDetails.innerHTML = `
            <strong>RECIPE ${index + 1}</strong>
            <p>Ingredients: ${recipe.ingredients}</p>
            <p>Glycemic Index: ${recipe.glycemicIndex}</p>
        `;

        // Update glucose chart
        updateChart(recipe.glycemicIndex);
    }

    // Update Chart with Glycemic Index
    function updateChart(glycemicIndex) {
        const insulinDose = insulinDosesSelect.value;

        const data = Array.from({ length: 10 }, (_, i) => glycemicIndex / insulinDose * Math.exp(-i / 2));

        if (glucoseChart) glucoseChart.destroy();

        glucoseChart = new Chart(glucoseChartCanvas, {
            type: "line",
            data: {
                labels: Array.from({ length: 10 }, (_, i) => i),
                datasets: [{
                    label: "Glucose Peak",
                    data: data,
                    borderColor: "rgba(75, 192, 192, 1)",
                    backgroundColor: "rgba(75, 192, 192, 0.2)",
                    borderWidth: 2,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    }
</script>
</body>

</html>
